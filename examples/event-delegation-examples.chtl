// CHTL JSå¢å¼ºè¯­æ³• - äº‹ä»¶å§”æ‰˜ç¤ºä¾‹
// å±•ç¤ºå¦‚ä½•ä½¿ç”¨äº‹ä»¶å§”æ‰˜è§£å†³SPAä¸­åŠ¨æ€å…ƒç´ çš„äº‹ä»¶ç»‘å®šé—®é¢˜

Import @Chtl from "Chtholly.Core.*"

// 1. åŸºç¡€äº‹ä»¶å§”æ‰˜
div {
    id: "todo-container"
    class: "container"
    
    h1 { "äº‹ä»¶å§”æ‰˜ç¤ºä¾‹" }
    
    // æ·»åŠ æŒ‰é’®
    button {
        id: "add-todo"
        class: "btn-primary"
        "æ·»åŠ ä»»åŠ¡"
    }
    
    // ä»»åŠ¡åˆ—è¡¨å®¹å™¨
    ul {
        id: "todo-list"
        class: "todo-list"
        
        // åˆå§‹ä»»åŠ¡
        li {
            class: "todo-item"
            data-id: "1"
            
            span { class: "todo-text"; "ç¤ºä¾‹ä»»åŠ¡ 1" }
            button { class: "btn-delete"; "åˆ é™¤" }
        }
    }
    
    script {
        // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†åŠ¨æ€æ·»åŠ çš„ä»»åŠ¡é¡¹
        {{"#todo-list"}}->delegate({
            target: ".todo-item",
            click: function(e) {
                // åˆ‡æ¢å®ŒæˆçŠ¶æ€
                if (!e.target.classList.contains('btn-delete')) {
                    this.classList.toggle('completed');
                }
            }
        });
        
        // åˆ é™¤æŒ‰é’®çš„äº‹ä»¶å§”æ‰˜
        {{"#todo-list"}}->delegate({
            target: ".btn-delete",
            click: function(e) {
                e.stopPropagation();
                const todoItem = this.closest('.todo-item');
                todoItem.remove();
            }
        });
        
        // æ·»åŠ æ–°ä»»åŠ¡
        let todoId = 2;
        {{"#add-todo"}}.addEventListener('click', () => {
            const li = document.createElement('li');
            li.className = 'todo-item';
            li.dataset.id = todoId++;
            li.innerHTML = `
                <span class="todo-text">æ–°ä»»åŠ¡ ${todoId - 1}</span>
                <button class="btn-delete">åˆ é™¤</button>
            `;
            {{"#todo-list"}}.appendChild(li);
        });
    }
    
    style {
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .todo-list {
            list-style: none;
            padding: 0;
        }
        
        .todo-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .todo-item:hover {
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .todo-item.completed .todo-text {
            text-decoration: line-through;
            color: #999;
        }
        
        .btn-primary {
            background: #67C3CC;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .btn-delete {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
    }
}

// 2. å¤šç›®æ ‡é€‰æ‹©å™¨çš„äº‹ä»¶å§”æ‰˜
div {
    class: "interactive-grid"
    
    h2 { "å¤šç›®æ ‡äº‹ä»¶å§”æ‰˜" }
    
    div {
        class: "grid-container"
        id: "grid"
        
        // åˆå§‹æ ¼å­
        div { class: "grid-item"; data-type: "normal"; "1" }
        div { class: "grid-item special"; data-type: "special"; "2" }
        div { class: "grid-item"; data-type: "normal"; "3" }
    }
    
    button {
        id: "add-grid-item"
        "æ·»åŠ æ ¼å­"
    }
    
    script {
        // ä½¿ç”¨å¤šä¸ªé€‰æ‹©å™¨è¿›è¡Œäº‹ä»¶å§”æ‰˜
        {{"#grid"}}->delegate({
            target: [".grid-item", ".special"],
            mouseenter: function(e) {
                this.style.transform = 'scale(1.1)';
            },
            mouseleave: function(e) {
                this.style.transform = 'scale(1)';
            },
            click: function(e) {
                const type = this.dataset.type;
                if (type === 'special') {
                    alert('è¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šæ ¼å­ï¼');
                } else {
                    this.style.backgroundColor = 
                        '#' + Math.floor(Math.random()*16777215).toString(16);
                }
            }
        });
        
        // åŠ¨æ€æ·»åŠ æ ¼å­
        let gridCount = 4;
        {{"#add-grid-item"}}.addEventListener('click', () => {
            const div = document.createElement('div');
            const isSpecial = Math.random() > 0.7;
            div.className = isSpecial ? 'grid-item special' : 'grid-item';
            div.dataset.type = isSpecial ? 'special' : 'normal';
            div.textContent = gridCount++;
            {{"#grid"}}.appendChild(div);
        });
    }
    
    style {
        .interactive-grid {
            margin-top: 40px;
        }
        
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .grid-item {
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f0f0;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .grid-item.special {
            background: #67C3CC;
            color: white;
            border-color: #5AB3BC;
        }
    }
}

// 3. å¤æ‚äº¤äº’çš„äº‹ä»¶å§”æ‰˜
div {
    class: "comment-section"
    
    h2 { "è¯„è®ºç³»ç»Ÿï¼ˆäº‹ä»¶å§”æ‰˜ï¼‰" }
    
    div {
        class: "comment-form"
        
        textarea {
            id: "comment-input"
            placeholder: "å†™ä¸‹ä½ çš„è¯„è®º..."
        }
        
        button {
            id: "submit-comment"
            "å‘è¡¨è¯„è®º"
        }
    }
    
    div {
        id: "comments"
        class: "comments-list"
        
        // ç¤ºä¾‹è¯„è®º
        div {
            class: "comment"
            data-id: "1"
            
            div {
                class: "comment-header"
                
                span { class: "author"; "ç”¨æˆ·1" }
                span { class: "time"; "åˆšåˆš" }
            }
            
            div { class: "comment-body"; "è¿™æ˜¯ä¸€æ¡ç¤ºä¾‹è¯„è®º" }
            
            div {
                class: "comment-actions"
                
                button { class: "btn-like"; "ğŸ‘ 0" }
                button { class: "btn-reply"; "å›å¤" }
                button { class: "btn-delete"; "åˆ é™¤" }
            }
        }
    }
    
    script {
        // è¯„è®ºæ“ä½œçš„äº‹ä»¶å§”æ‰˜
        {{"#comments"}}->delegate({
            target: ".btn-like",
            click: function(e) {
                const count = parseInt(this.textContent.match(/\d+/)[0]) + 1;
                this.textContent = `ğŸ‘ ${count}`;
                this.classList.add('liked');
            }
        });
        
        {{"#comments"}}->delegate({
            target: ".btn-reply",
            click: function(e) {
                const comment = this.closest('.comment');
                const author = comment.querySelector('.author').textContent;
                {{"#comment-input"}}.value = `@${author} `;
                {{"#comment-input"}}.focus();
            }
        });
        
        {{"#comments"}}->delegate({
            target: ".btn-delete",
            click: function(e) {
                if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è¯„è®ºå—ï¼Ÿ')) {
                    this.closest('.comment').remove();
                }
            }
        });
        
        // æ·»åŠ æ–°è¯„è®º
        let commentId = 2;
        {{"#submit-comment"}}.addEventListener('click', () => {
            const content = {{"#comment-input"}}.value.trim();
            if (!content) return;
            
            const comment = document.createElement('div');
            comment.className = 'comment';
            comment.dataset.id = commentId++;
            comment.innerHTML = `
                <div class="comment-header">
                    <span class="author">å½“å‰ç”¨æˆ·</span>
                    <span class="time">åˆšåˆš</span>
                </div>
                <div class="comment-body">${content}</div>
                <div class="comment-actions">
                    <button class="btn-like">ğŸ‘ 0</button>
                    <button class="btn-reply">å›å¤</button>
                    <button class="btn-delete">åˆ é™¤</button>
                </div>
            `;
            
            {{"#comments"}}.insertBefore(comment, {{"#comments"}}.firstChild);
            {{"#comment-input"}}.value = '';
        });
    }
    
    style {
        .comment-section {
            margin-top: 40px;
            max-width: 600px;
        }
        
        .comment-form {
            margin-bottom: 20px;
        }
        
        #comment-input {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
        }
        
        #submit-comment {
            margin-top: 10px;
            background: #67C3CC;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .comment {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
        }
        
        .comment-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
        }
        
        .author {
            font-weight: bold;
            color: #333;
        }
        
        .comment-body {
            margin-bottom: 12px;
            line-height: 1.5;
        }
        
        .comment-actions {
            display: flex;
            gap: 10px;
        }
        
        .comment-actions button {
            background: none;
            border: 1px solid #ddd;
            padding: 4px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .comment-actions button:hover {
            background: #f5f5f5;
        }
        
        .btn-like.liked {
            background: #67C3CC;
            color: white;
            border-color: #67C3CC;
        }
    }
}

// 4. ä½¿ç”¨{{&}}é…åˆäº‹ä»¶å§”æ‰˜
div {
    class: "card-container"
    id: "cards"
    
    h2 { "å¡ç‰‡ç³»ç»Ÿ" }
    
    script {
        // åˆ›å»ºåˆå§‹å¡ç‰‡
        for (let i = 1; i <= 3; i++) {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `
                <h3>å¡ç‰‡ ${i}</h3>
                <p>è¿™æ˜¯å¡ç‰‡ ${i} çš„å†…å®¹</p>
                <button class="card-action">æ“ä½œ</button>
            `;
            {{&}}.appendChild(card);
        }
        
        // ä½¿ç”¨{{&}}ä½œä¸ºå§”æ‰˜çˆ¶å…ƒç´ 
        {{&}}->delegate({
            target: ".card",
            mouseenter: function(e) {
                this.style.boxShadow = '0 4px 8px rgba(0,0,0,0.2)';
            },
            mouseleave: function(e) {
                this.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
            }
        });
        
        {{&}}->delegate({
            target: ".card-action",
            click: function(e) {
                const card = this.closest('.card');
                const title = card.querySelector('h3').textContent;
                alert(`æ‰§è¡Œ${title}çš„æ“ä½œ`);
            }
        });
        
        // åŠ¨æ€æ·»åŠ æ›´å¤šå¡ç‰‡
        let cardCount = 4;
        setInterval(() => {
            if (cardCount <= 6) {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>æ–°å¡ç‰‡ ${cardCount}</h3>
                    <p>è¿™æ˜¯åŠ¨æ€æ·»åŠ çš„å¡ç‰‡ ${cardCount}</p>
                    <button class="card-action">æ“ä½œ</button>
                `;
                {{&}}.appendChild(card);
                cardCount++;
            }
        }, 2000);
    }
    
    style {
        .card-container {
            margin-top: 40px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: box-shadow 0.3s;
        }
        
        .card h3 {
            margin-top: 0;
            color: #333;
        }
        
        .card p {
            color: #666;
            margin: 10px 0;
        }
        
        .card-action {
            background: #67C3CC;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .card-action:hover {
            background: #5AB3BC;
        }
    }
}

// 5. å…¨å±€æ ·å¼
style {
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f5f5f5;
        margin: 0;
        padding: 20px;
    }
    
    h1, h2 {
        color: #333;
    }
}